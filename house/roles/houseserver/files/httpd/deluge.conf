<VirtualHost *:80>
    ServerName deluge.bergman.house

    Alias /.well-known/acme-challenge/ "/var/www/html/.well-known/acme-challenge/"
    <Directory "/var/www/html/">
        AllowOverride None
        Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
        Require method GET POST OPTIONS
    </Directory>

    RewriteEngine on
    RewriteCond %{REQUEST_URI} !^/.well-known/acme-challenge [NC]
    RewriteCond %{HTTPS} off
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
</VirtualHost>

<VirtualHost *:443>
    SSLEngine on
    SSLProxyEngine on
    ServerName deluge.bergman.house
    SSLCertificateFile /storage/tls/letsencrypt/live/deluge.bergman.house/fullchain.pem
    SSLCertificateKeyFile /storage/tls/letsencrypt/live/deluge.bergman.house/privkey.pem

    SSLProxyEngine on
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    SSLProxyCheckPeerExpire off
    ProxyRequests off

    ProxyPass "/" "http://127.0.0.1:8112/"
    ProxyPassReverse "/" "http://127.0.0.1:8112/"
</VirtualHost>
