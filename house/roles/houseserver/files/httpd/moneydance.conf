<VirtualHost *:80>
    ServerName moneydance.bergman.house

    Alias /.well-known/acme-challenge/ "/var/www/html/.well-known/acme-challenge/"
    <Directory "/var/www/html/">
        AllowOverride None
        Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
        Require method GET POST OPTIONS
    </Directory>

    RewriteEngine on
    RewriteCond %{REQUEST_URI} !^/.well-known/acme-challenge [NC]
    RewriteCond %{HTTPS} off
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
</VirtualHost>

<VirtualHost *:443>
    SSLEngine on
    SSLProxyEngine on
    ServerName moneydance.bergman.house
    SSLCertificateFile /storage/tls/letsencrypt/live/moneydance.bergman.house/fullchain.pem
    SSLCertificateKeyFile /storage/tls/letsencrypt/live/moneydance.bergman.house/privkey.pem

    ProxyRequests off
    ProxyPass "/" "http://10.6.0.10/"
    ProxyPassReverse "/" "http://10.6.0.10/"

    RewriteEngine on
    RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
    RewriteCond %{HTTP:CONNECTION} ^Upgrade$ [NC]
    RewriteRule .* ws://10.6.0.10%{REQUEST_URI} [P]
</VirtualHost>
